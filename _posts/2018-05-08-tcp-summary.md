---
layout: post
title: TCP 知识总结
excerpt: TCP、三次握手、四次挥手
category: others
---

[TCP 总结](https://juejin.im/post/5ae2711bf265da0b873a3657)

#### 名词解释

IP（Internet Protocol）：因特网协议，它可以根据网络情况，将要传输的数据，分为不同大小的包、固定的格式，在源地址和目的地址之间传送。IP协议在现实生活中就好比规定了包装箱的尺寸和包装方法。

IP的头部只有16位首部校验和，只能对ip头信息进行数据校验，但对数据本身是没有校验的。

TCP （Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议。

IP协议也有一些缺陷（传输不可靠也就是不提供点到点的传输确认、对数据没有完整性校验、不能重发和流量控制）。就好比货是打包发走了，但对方收没收到货物不管，货物是否完好无损不管。

TCP协议在IP协议的基础上提供了可靠地面向对象的数据流传输服务的规则和约定。简单说，就是发送一个数据包，我就要确认对方有效，完整的收到。

TCP的头部16位校验和是对数据的完整性校验。

#### TCP/IP四层模型与OSI七层模型的对应关系

TCP/IP与OSI最大的不同在于OSI是一个理论上的网络通信模型，而TCP/IP则是实际运行的网络协议。
IP协议在网络层。TCP和UDP协议在传输入层。
TCP： FTP、HTTP、Telnet、SMTP、POP3、HTTPS
UDP：DNS、SNMP、NFS

#### TCP和UDP的区别

TCP是有连接的，两台主机在进行数据交互之前必须先通过三次握手建立连接；而UDP是无连接的，没有建立连接这个过程。

TCP是可靠的传输，TCP协议通过确认和重传机制来保证数据传输的可靠性；而UDP是不可靠的传输。

TCP还提供了拥塞控制、滑动窗口等机制来保证传输的质量，而UDP都没有。

TCP是基于字节流的，将数据看做无结构的字节流进行传输，当应用程序交给TCP的数据长度太长，超过MSS时，TCP就会对数据进行分段，因此TCP的数据是无边界的；而UDP是面向报文的，无论应用程序交给UDP层多长的报文，UDP都不会对数据报进行任何拆分等处理，因此UDP保留了应用层数据的边界。

#### 三次握手

- 第一次握手：客户端想与服务器建立连接传送数据，客户端调用向服务器发送TCP报文请求，等待服务器的确认。
- 第二次握手：正在处于LISTEN状态的服务器端接受到客户端发来的SYN报文后，发送返回确认信息，表示我收到了你的请求，我可以与你建立连接收发数据。
- 第三次据手：客户端将确认报文回发给服务器，表示我知道服务器端你已经收到我发送的第一次握手请求。然后进入ESTABLISHED状态。
- 服务器端收到第三次握手后，进入ESTABLISHED状态。到此完成TCP三次握手，可以接下来收发数据。

#### 四次挥手

- 第一次挥手：客户说数据传完啦，我想和你断开连接，然后发送TCP报文，然后进入FIN_WAIT_1状态；
- 第二次挥手：服务器收到第一次挥手的请求后，回复说我收到了，然后服务器进入CLOSE_WAIT状态;
- 客户端收到以后状态改为FIN_WAIT_2。
- 第三次挥手：服务器向客户端发送：FIN = 1, Sequence Number = y + 1; 然后服务器进入LAST_ACK状态;
- 第四次挥手：客户端收到服务器发送的FIN报文，回复服务器，然后进入TIME_WATI状态，服务器收到以后就关闭连接，此时，客户端还会等待2MSL后，依然没有收到服务器端任何回复，就表示服务器端正常关闭，那客户端也就关闭了。
